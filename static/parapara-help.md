# PDF-ParaParaTrans

PDFから

## 注意

- ver2.0.0以前のバージョンとデータの互換性がありません。<br>申し訳ありませんが、必ず別フォルダに配置して使用してください。<br>翻訳文を旧型式からインポートするスクリプトを同梱していますが、段落構成が異なるため不完全な適用となります。ご容赦ください。
- google翻訳APIが日本語を一度英語にして再翻訳する挙動をするケースがあります。<br>この場合対訳辞書による用語統一が効きません。<br>google公式の対訳辞書を使用する手順が煩雑なため現時点では搭載を見送っています。
- google翻訳で初回(もしくは長時間APIにアクセスしなかった場合)エラーになるようです。<br>その場合は再度ページ翻訳などを実行すれば成功します。狙って再現できないため、解消は少し先になりそうです。

## おすすめの作業方法
1. PDFをdataフォルダに入れます。
2. 詳細画面から `1.パラグラフ抽出` →　`自動タグ付け`
3. 詳細画面で「PDF」「原文」「連結文」にチェックを入れて3つのペインを表示します。
4. 各ページで文の構成と順序を確認しながら、必要に応じて下記作業を行います。
    - Alt+上下矢印で順序を整える。
    - Alt++で途中で切れている段落を結合する。
    - Alt+数値で本文(Alt+0)、見出し(Alt+1-6)、ヘッダ(Alt+7)、フッタ(Alt+8)を整える。
    - 特定のスタイルの見出しを一気に設定したい場合、編集パネルを開いて`同スタイルを一括更新` 。
5. 一章分などきっりのよい分量のページを整えたら `2.連結` をクリック。
6. 表示を「PDF」「結合分」「自動」の3ペインにします。
7. 整形した範囲の最初のページから `ページ対訳置換` → `ページ翻訳` を繰り返していきます。
8. 対訳辞書に登録した方がよい単語を見つけたら `辞書登録`
9. 整形した範囲の自動翻訳が終わったら、表示を「連結文」「自動」「訳文」の3ペインにします。
10. 各段落で編集ボタンをクリックし、訳を整え終わったらステータスを `確定` に変更します。
11. 3から10までを全ページ終わるまで繰り返します。
12. `5.対訳HTML出力` をクリックして `data` フォルダのhtmlファイルを参照しやすい場所にコピーします。完成！

# 一覧画面
- `data` フォルダに置かれたPDFファイルの一覧を表示します。
- 詳細画面でパラグラフ抽出を行うと、`data` フォルダに `(PDF名).json` ファイルが作られます。<br>これが `PDF-ParaParaTrans` が使用する `ブックデータ` です。

## ヘルプツールチップ
このアプリケーションでは、一部のUI要素にマウスカーソルを合わせると、機能に関する説明がツールチップとして表示されます。
ツールチップの内容は、`static/parapara-help.md` ファイルから取得されています。

## ブックリストの更新
ブックリストを最新の状態に更新します。新しいPDFファイルをdataフォルダに追加した場合などにクリックしてください。

## ブックのフィルタリング
タイトルまたはファイル名でPDFリストをフィルタリングします。<br>検索語を入力してボタンをクリックしてください。

# 詳細画面

## 一覧画面に戻る
一覧画面に戻ります。

## パラグラフの抽出
PDFからパラグラフを抽出します。<br>この操作はPDFのサイズによっては時間がかかる場合があります。
- PyMuPdfの「ブロック」を単位としてデータを抽出しています。<br>PDFの作成方法によっては文のつながりがおかしくなったり、表の読み順が崩れたりします。これはPDF-ParaParaTransでは対策できないのでご容赦ください。
- PDFファイルの一番上のブロックと一番下のブロックからヘッダー/フッタを統計的に求めています。<br>3回以上同位置に同文字列や数値のみブロックが現れるとblock_tagにheader/footerをセットします。

## 自動タグ付け
抽出されたパラグラフのスタイル(PDFで指定されていたfont-nameとfont-size)に基づいて、荒い判定でタグ付けを行います。

1. **シンボルフォントの判定**:
   - **ルール**: フォントがシンボルフォント（例: Wingdings, Webdings）に該当するスタイルは、`block_tag` を `p`（本文）に設定します。
   - **理由**: シンボルフォントは通常、見出しや重要なテキストではなく、装飾やアイコンとして使用されるためです。

2. **連続出現行数の判定**:
   - **ルール**: 同じスタイルが1ページに4行以上連続して出現するスタイルは、`block_tag` を `p` に設定します。
   - **理由**: 連続した行として出現するスタイルは、本文やリスト項目である可能性が高いと判断します。

3. **文字数の判定**:
   - **ルール**: 100文字以上のパラグラフを持つスタイルは、`block_tag` を `p` に設定します。
   - **理由**: 長いテキストを持つスタイルは本文である可能性が高いと判断します。

4. **章見出し(h1)**:
   - **ルール**: フォントサイズが本文フォントサイズより大きく、1ページに1回だけ出現する場合、`block_tag` を `h1` に設定します。
   - **理由**: PDF-Paraparatransでは `h1` を文書全体のタイトルではなく「章」見出しと考えています。そのため1ページに1回以上出現するスタイルはH3以下としています。

5. **ページ内に3回まで出現する見出し(h3)**:
   - **ルール**: フォントサイズが本文フォントサイズより大きく、1ページに最大3回出現するスタイルは、`block_tag` を `h3` に設定します。
   - **理由**: PDF-Paraparatransでは `h3` を「ページ内に複数出現する見出しの中で最上位」と考えています。<br>自動タグ付けでは `h1` と `h3` の間をあけて、 `h2` にするかどうかの判断ができるようにしています。 

6. **ページ内に4回以上出現する見出し(h5)**:
   - **ルール**: フォントサイズが本文フォントサイズより大きく、1ページに4回以上出現するスタイルは、`block_tag` を `h5` に設定します。
   - **理由**: 頻繁に出現するスタイルは、リストの見出しや小見出しとして使用される可能性があるためです。<br> `h4` と `h6` を空けることで、あとで階層を調整しやすいようにしています。

7. **その他**:
   - **ルール**: 上記のいずれにも該当しない場合、`block_tag` を `p` に設定します。

## パラグラフの連結
自動タグ付けされたパラグラフを連結します。

## 辞書の作成
抽出・連結されたパラグラフから辞書を作成します。

## 辞書の翻訳
作成された辞書を翻訳します。（現在非表示）

## 全ての対訳を置換
全ての対訳を辞書に基づいて置換します。

## 全てのページを翻訳
全てのページを翻訳します。この操作は時間がかかる場合があります。

## 構造の保存
現在の構成をファイルに保存します。（現在未リリース）

## HTMLのエクスポート
対訳付きのHTMLファイルをエクスポートします。

## ブックデータのリロード
書籍データをリロードします。（現在未リリース）

## HTMLの再レンダリング
HTMLを再レンダリングします。（現在未リリース）

## 目次パネルの表示/非表示
目次パネルの表示/非表示を切り替えます。

## PDFパネルの表示/非表示
PDFパネルの表示/非表示を切り替えます。

## 前のページ
前のページに移動します。

## 次のページ
次のページに移動します。

## ページの翻訳
現在のページを翻訳します。

## ソースHTMLの表示/非表示
ソースHTMLの表示/非表示を切り替えます。

## 原文の表示/非表示
原文の表示/非表示を切り替えます。

## 連結文の表示/非表示
連結文の表示/非表示を切り替えます。

## 置換文の表示/非表示
置換文の表示/非表示を切り替えます。

## 自動翻訳の表示/非表示
自動翻訳の表示/非表示を切り替えます。

## 訳文の表示/非表示
訳文の表示/非表示を切り替えます。

## ログを開く
ログウィンドウを開きます。

## ホットキーマッパーを開く
ホットキーマッパーウィンドウを開きます。

## 高速編集モード
高速編集モードのオン/オフを切り替えます。

## 構造の順序を保存
構造の順序を保存します。
