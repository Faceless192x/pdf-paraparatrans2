<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <title>PDF ParaParaTrans - ブック詳細画面</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='paraparatrans.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tocPanel.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/searchPanel.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/srcPanel.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/help-tooltip.css') }}">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/header-actions-menu.css') }}">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/auto-toggle.css') }}">
    <script src="{{ url_for('static', filename='js/auto-toggle.js') }}"></script>    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/hotkey-mapper.css') }}">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <style class="book-data-styles"></style>   
    <script src="/static/js/floating_log.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dict.css') }}">

  </head>

<body data-pdf-name="{{ pdf_name }}">
    <div class="header-container">
        <div class="left header-left">
          <div class="basic-info">
            <span class="inline-block-margin">
              <button type="button" data-href="{{ url_for('index', dir=index_dir) }}" onclick="window.location.href=this.dataset.href" data-help-id="一覧画面に戻る">戻る</button>
              Title: <input type="text" id="titleInput" value="{{ book_data.title|e }}" class="title-input">
              <button id="saveOrderButton" data-help-id="表題と構造を保存">保存</button>
              FileName: {{ pdf_name }} / Update: {{ updated_date }}
            </span>
            <span class="inline-block-margin">
              <button onclick="extractParagraphs()" class="btn-step btn-step-extract" data-help-id="パラグラフの抽出">1.パラグラフ抽出</button>
              <button onclick="rebuildSrcTextFromHtml()" data-help-id="シンボル置換">(シンボル置換)</button>
              <button onclick="autoTagging()" data-help-id="自動タグ付け">(自動タグ付け)</button>
              <button onclick="joinParagraphs()" class="btn-step btn-step-join" data-help-id="すべてのページで段落の連結">2.段落連結</button>
              <button onclick="dictTrans()" hidden data-help-id="辞書の翻訳">(辞書翻訳)</button>
              <button onclick="dictReplaceAll()" class="btn-step btn-step-dict" data-help-id="すべてのページを対訳置換">3.全対訳置換</button>
              <button onclick="transAllPages()" class="btn-step btn-step-transall" data-help-id="すべてのページを翻訳">4.全翻訳</button>
              <button id="alignTransBySrcJoinedButton" class="btn-step btn-step-transall" data-help-id="同一連結文の訳揃え">(訳揃え)</button>
              <button onclick="fetchBookData()" hidden data-help-id="ブックデータのリロード">リロード</button>
              <button id="renderButton" hidden data-help-id="HTMLのレンダリング">レンダリング</button>
            </span>

            <span class="inline-block-margin">
              <button
                type="button"
                id="dataActionsButton"
                class="btn-step btn-step-export"
                onclick="openDataExportDialog()"
                data-help-id="データ入出力ダイアログ"
              >データ</button>
              <input id="docStructureFileInput" type="file" accept=".json" style="display:none" onchange="importDocStructureFile(this.files)">
            </span>
          </div>
          <div class="controls">
            <table class="trans_status_counts">
              <tr>
                <th>none</th>
                <td id="countNone">0</td>
                <th>auto</th>
                <td id="countAuto">0</td>
                <th>draft</th>
                <td id="countDraft">0</td>
                <th>fixed</th>
                <td id="countFixed">0</td>
              </tr>
            </table>

            <span class="inline-block-margin">
              <span id="toggleTocPanel" class="auto-toggle" data-auto-toggle="appearance:checkbox;storage:local;default:true" data-help-id="目次パネルの表示/非表示">目次</span>
              <span id="togglePdfPanel" class="auto-toggle" data-auto-toggle="appearance:checkbox;storage:local;default:true" data-help-id="PDFパネルの表示/非表示">PDF</span>
              <span id="toggleSrcHtml" class="auto-toggle" data-auto-toggle="appearance:checkbox;storage:local;default:false" data-help-id="ソースHTMLの表示/非表示">Html</span>
              <span id="toggleSrcText" class="auto-toggle" data-auto-toggle="appearance:checkbox;storage:local;default:true" data-help-id="原文の表示/非表示">原文</span>
              <span id="toggleSrcJoined" class="auto-toggle" data-auto-toggle="appearance:checkbox;storage:local;default:true" data-help-id="連結文の表示/非表示">連結文</span>
              <span id="toggleSrcReplaced" class="auto-toggle" data-auto-toggle="appearance:checkbox;storage:local;default:true" data-help-id="置換文の表示/非表示">置換文</span>
              <span id="toggleTransAuto" class="auto-toggle" data-auto-toggle="appearance:checkbox;storage:local;default:true" data-help-id="自動翻訳の表示/非表示">Auto</span>
              <span id="toggleTransText" class="auto-toggle" data-auto-toggle="appearance:checkbox;storage:local;default:true" data-help-id="訳文の表示/非表示">訳文</span>
              <span id="toggleCommentText" class="auto-toggle" data-auto-toggle="appearance:checkbox;storage:local;default:false" data-help-id="コメントの表示/非表示">コメント</span>
            </span>

            <span class="inline-block-margin">
              <button onclick="prevPage()" data-help-id="前のページ">◀</button>
              <input type="number" id="pageInput" value="1" min="1" max="1" 
                    class="page-input" onchange="jumpToPage(this.value)">
              <span>/</span>
              <span id="pageCount">1</span>
              <button onclick="nextPage()" data-help-id="次のページ">▶</button>
            </span>

            <button id="pageDictReplaceButton" class="btn-step btn-step-dict" data-help-id="ページ対訳置換">ページ対訳置換</button>
            <button id="pageTransButton" class="btn-step btn-step-transall" data-help-id="ページの翻訳">ページ翻訳</button>
            <button id="openDictButton" data-help-id="辞書登録">辞書登録</button>
            <button id="openLogButton" onclick="showLog()" data-help-id="ログを開く">Log</button>
            <span id="toggleHotkeyInput" class="auto-toggle" data-auto-toggle="appearance:checkbox;storage:local;default:false" data-help-id="ショートカット入力の表示/非表示" style="display:none">KeyHUD</span>
            <button id="openHotKeyButton" onclick="HotkeyMapper.showHelpWindow()" data-help-id="ホットキーマッパーを開く">HotKey</button>
            <button id="show-full-help">Help</button>
          </div>
        </div>
      </div>

    <div class="container">
        <div id="tocPanel" class="panel">
          <div id="tocPanelHeader" class="panel-header">
            <span id="toggleTocPage" class="auto-toggle" data-auto-toggle="appearance:checkbox;storage:local">Page</span>
            <span id="toggleTocSrc" class="auto-toggle" data-auto-toggle="appearance:checkbox;storage:local">原文</span>
            <span id="toggleTocTrans" class="auto-toggle" data-auto-toggle="appearance:checkbox;storage:local">訳文</span>
          </div>
          <div class="toc-scroll-wrapper">
            <table class="tocTable">
              <tbody>
              </tbody>
            </table>
          </div>
          <div id="resizerTocSearch" class="resizer-row"></div>
          <div id="tocSearchPanel">
            <div class="toc-search-row">
              <input id="tocSearchInput" type="text" placeholder="全文検索 (src_joined / trans_text / trans_auto)">
              <button id="tocSearchButton" type="button">検索</button>
              <button id="tocSearchClearButton" type="button" title="クリア">×</button>
            </div>
            <div id="tocSearchStatus"></div>
            <div id="tocSearchResults"></div>
          </div>
        </div>
        <div id="resizer1" class="resizer"></div>

        <div id="pdfPanel" class="panel flex-panel pdf-panel">
            <iframe id="pdfIframe" class="pdf-iframe"></iframe>
            <div id="overlay" class="overlay"></div>
        </div>

        <div id="resizer2" class="resizer"></div>

        <div class="panel flex-panel" id="srcPanel">
            <div id="srcParagraphs"></div>
        </div>
    </div>
    <div id="dataExportDialog" class="data-export-dialog" style="display:none">
      <div class="data-export-dialog__backdrop" onclick="closeDataExportDialog()"></div>
      <div class="data-export-dialog__content" role="dialog" aria-modal="true" aria-labelledby="dataExportDialogTitle">
        <div class="data-export-dialog__header">
          <div id="dataExportDialogTitle" class="data-export-dialog__title">データ入出力</div>
          <button type="button" class="data-export-dialog__close" onclick="closeDataExportDialog()">×</button>
        </div>
        <div class="data-export-dialog__section">
          <div class="data-export-dialog__section-title">HTML/構造</div>
          <div class="data-export-dialog__row">
            <button type="button" class="btn-step btn-step-export" onclick="exportHtml()">対訳HTML出力</button>
            <button type="button" class="btn-step btn-step-export" onclick="exportDocStructure()">構造ファイル出力</button>
            <button type="button" class="btn-step btn-step-export" onclick="openDocStructurePicker()">構造ファイル取込</button>
          </div>
        </div>
        <div class="data-export-dialog__section">
          <div class="data-export-dialog__section-title">Markdown/テキスト</div>
          <div class="data-export-dialog__row">
            <label for="dataExportFormat">形式</label>
            <select id="dataExportFormat">
              <option value="md" selected>Markdown (.md)</option>
              <option value="txt">Text (.txt)</option>
            </select>
            <label class="data-export-checkbox">
              <input id="dataExportIncludePage" type="checkbox" checked>
              ページ番号
            </label>
            <label class="data-export-checkbox">
              <input id="dataExportIncludeHeader" type="checkbox">
              header
            </label>
            <label class="data-export-checkbox">
              <input id="dataExportIncludeFooter" type="checkbox">
              footer
            </label>
            <label class="data-export-checkbox">
              <input id="dataExportIncludeRemove" type="checkbox">
              remove
            </label>
          </div>
          <div class="data-export-dialog__row data-export-options">
            <label><input class="data-export-field" type="checkbox" value="src_text">原文</label>
            <label><input class="data-export-field" type="checkbox" value="src_joined" checked>連結文</label>
            <label><input class="data-export-field" type="checkbox" value="src_replaced">置換文</label>
            <label><input class="data-export-field" type="checkbox" value="trans_auto">自動翻訳</label>
            <label><input class="data-export-field" type="checkbox" value="trans_text" checked>訳文</label>
          </div>
          <div id="dataExportFieldHint" class="data-export-dialog__hint">2つまで選択できます。選択した順に交互出力します。</div>
          <div class="data-export-dialog__row">
            <button id="dataExportRunButton" type="button" class="btn-step btn-step-export" onclick="exportTextOrMd()">Markdown/テキスト出力</button>
          </div>
          <div id="dataExportStatus" class="data-export-status"></div>
        </div>
        <div class="data-export-dialog__section">
          <div class="data-export-dialog__section-title">辞書</div>
          <div class="data-export-dialog__row">
            <button type="button" class="btn-step btn-step-export" onclick="openDictMaintenance()">対訳辞書メンテナンス</button>
          </div>
          <div class="data-export-dialog__row">
            <button type="button" class="btn-step btn-step-export" onclick="reloadDictSelection()">辞書一覧更新</button>
            <button type="button" class="btn-step btn-step-export" onclick="saveDictSelection()">適用辞書を保存</button>
          </div>
          <div id="dictSelectionStatus" class="data-export-status"></div>
          <div id="dictSelectionList" class="dict-selection-list"></div>
        </div>
      </div>
    </div>
  <script src="{{ url_for('static', filename='js/pdf-name.js') }}"></script>
  <script src="{{ url_for('static', filename='js/dict.js') }}"></script>
  <script src="{{ url_for('static', filename='js/tocPanel.js') }}"></script>    
  <script src="{{ url_for('static', filename='js/pdfPanel.js') }}"></script>    
  <script src="{{ url_for('static', filename='js/srcPanel.js') }}"></script>    
  <script src="{{ url_for('static', filename='js/detail.js') }}"></script>    
  <script src="{{ url_for('static', filename='js/fetch.js') }}"></script>    
  <script src="{{ url_for('static', filename='js/searchPanel.js') }}"></script>
  <script src="{{ url_for('static', filename='js/header-actions-menu.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/hotkey-mapper.js') }}" defer></script>    
  <script src="{{ url_for('static', filename='js/keyDown.js') }}" defer></script>    
  <script src="{{ url_for('static', filename='js/help.js') }}"></script>
</body>

</html>
